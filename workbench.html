<!DOCTYPE html>
<html><head>
<meta charset="utf-8">
<title>doT workbench</title>
<style>
textarea { display: block; width: 100%; height: 100px; }
button { display: block; }
pre { white-space: pre-wrap; }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/styles/vs.min.css">
</head><body>
<div>Source:</div>
<pre id="source"></pre>
<div>Compiled template (<input type="checkbox" id="beautify"> beautify):</div>
<pre id="compiled">not yet compiled</pre>
<div>Context data (JSON):</div>
<textarea id="data"></textarea>
<div>Output:</div>
<pre id="output">not yet evaluated</pre>
<pre id="diag">not yet evaluated</pre>
<script src="doT.js"></script>
<script src="https://cdn.rawgit.com/jshint/jshint/2.7.0/dist/jshint.js"></script>
<script src="https://cdn.rawgit.com/beautify-web/js-beautify/v1.5.5/js/lib/beautify.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.6/highlight.min.js"></script>
<script src="https://cdn.rawgit.com/n9/ace/5d4676dbaa61bf04a3ad183768f06059bf187170/demo/kitchen-sink/require.js"></script>
<style>li.L0, li.L1, li.L2, li.L3,li.L5, li.L6, li.L7, li.L8{ list-style-type: decimal !important } .ace_n9dotToken { background: rgba(0, 0, 0, 0.05); } .ace_n9dotExpression {	background: rgba(0, 128, 0, 0.05); }</style>
<script>
	require.config({paths: { "ace" : "https://cdn.rawgit.com/n9/ace/5d4676dbaa61bf04a3ad183768f06059bf187170/lib/ace"}});
	require(["ace/ace"], function(ace) {
		function E(id) { return document.getElementById(id); }
		function no() { return false; }

		var aceSource = ace.edit('source');
		aceSource.setOptions({
			minLines: 10,
			maxLines: 20
		});
		aceSource.session.setMode("ace/mode/n9dot");
		var eData = E('data');
		var eCompiled = E('compiled');
		var eOutput = E('output');
		var eDiag = E('diag');
		var eBeautify = E('beautify');
		var dotGlobals = {};
		doT.globals().forEach(function(v) {
			dotGlobals[v] = true;
		});

		function doTcompile() { 
			var source = aceSource.session.getValue();
			var data = eData.value;
			var beautify = eBeautify.checked;
			try {
				localStorage.setItem('source', source)
				localStorage.setItem('data', data)
				localStorage.setItem('nobeautify', beautify ? "" : "t")
			} catch (e) {
				// ignore
			}
			
			var compiled; 
			try { 
				compiled = doT.template(source);
				if (beautify)
					compiled = js_beautify(compiled);
				eCompiled.innerHTML = hljs.highlight("javascript", compiled).value;
			} catch (e) {
				eCompiled.textContent = e;
				return;
			}
					
			try {
				var r = JSHINT(compiled, null, dotGlobals);
				eDiag.textContent = "errors: " + JSHINT.errors.map(function(e) { return "[" + e.line + "," + e.character + "] " + e.reason; }).join("\r\n")
					+ "\r\nundefs: " + JSHINT.undefs.map(function(u) { return "[" + u[2].line + "," + u[2].character + "] " + u[2].value; }).join("\r\n");
			} catch (e) {
				eDiag.textContent = e;
			}
			
			try { 
				var output = doT.wrap(compiled)(JSON.parse(eData.value), {
					i: doT.interpolate, 
					c: doT.condition, 
					l: doT.loop, 
					b: doT.block, 
					bm: no
				});
				eOutput.textContent = output;
			} catch (e) {
				eOutput.textContent = e;
			}
		}
			
		var s = localStorage.getItem('source');
		if (s === null || s === '')
			s = 'Hello {{it}}!';
		aceSource.session.setValue(s);
		aceSource.on('input', doTcompile);
		var b = localStorage.getItem('nobeautify');
		eBeautify.checked = !b;
		eBeautify.onclick = doTcompile;
		eBeautify.onchange = doTcompile;
		var d = localStorage.getItem('data');
		if (d === null || d === '')
			d = '"World"';
		eData.value = d;
		eData.onchange = doTcompile;
		eData.onkeyup = doTcompile;
		doTcompile();
	});
</script>
</body></html>
